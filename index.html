<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„ BTC äº¤æ˜“ä»ªè¡¨ç›˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-900 text-white p-6">

    <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
            <h2 class="text-gray-400 text-sm mb-2">BTC å®æ—¶ä»·æ ¼</h2>
            <div id="btc-price" class="text-3xl font-bold text-green-400">åŠ è½½ä¸­...</div>
        </div>
        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
    <h2 class="text-gray-400 text-sm mb-2">ææƒ§è´ªå©ªæŒ‡æ•° (å®æ—¶æ’ä»¶)</h2>
    <img src="https://alternative.me/crypto/fear-and-greed-index.png" alt="Latest Crypto Fear & Greed Index" class="rounded-lg w-full">
</div>
        </div>
        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
            <h2 class="text-gray-400 text-sm mb-2">è·ç¦»ä¸‹ä¸€æ¬¡å‡åŠ</h2>
            <div id="halving-countdown" class="text-3xl font-bold text-blue-400">åŠ è½½ä¸­...</div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto mb-8">
        <div class="bg-gray-800 p-8 rounded-xl border border-blue-500/50 shadow-lg shadow-blue-500/10 text-center">
            <h2 class="text-xl font-bold mb-4">ahr999 å›¤å¸æŒ‡æ ‡ & ç­–ç•¥å»ºè®®</h2>
            <div id="ahr-value" class="text-6xl font-black mb-4 text-yellow-400">0.00</div>
            <div id="ahr-strategy" class="text-2xl font-bold py-2 px-6 rounded-full inline-block bg-gray-700">
                æ­£åœ¨åˆ†æå¸‚åœºæ•°æ®...
            </div>
            <p class="text-gray-500 mt-4 text-sm">
                ç­–ç•¥ï¼š< 0.45 æŠ„åº• | 0.45-1.2 å®šæŠ• | > 1.2 ç­‰å¾…
            </p>
        </div>
    </div>

    <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
            <h3 class="text-lg mb-4 border-b border-gray-700 pb-2 text-blue-300">æŠ€æœ¯æŒ‡æ ‡ (æ—¥çº¿)</h3>
            <div class="space-y-4">
                <div class="flex justify-between"><span>RSI (14):</span> <span id="rsi-val" class="font-mono">--</span></div>
                <div class="flex justify-between"><span>120æ—¥å‡çº¿ (MA120):</span> <span id="ma120-val" class="font-mono text-gray-300">--</span></div>
                <div class="flex justify-between"><span>200æ—¥å‡çº¿ (MA200):</span> <span id="ma200-val" class="font-mono text-gray-300">--</span></div>
            </div>
        </div>
        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
            <h3 class="text-lg mb-4 border-b border-gray-700 pb-2 text-green-300">ahr999 è®¡ç®—è¯¦æƒ…</h3>
            <div class="space-y-4 text-sm text-gray-400">
                <p>ahr999 æŒ‡æ•°ç”±å½“å‰ä»·æ ¼ä¸ 200 æ—¥å®šæŠ•æˆæœ¬ã€æŒ‡æ•°å¢é•¿æ‹Ÿåˆä¼°å€¼è®¡ç®—å¾—å‡ºã€‚è¯¥æŒ‡æ ‡æ—¨åœ¨å¯»æ‰¾é•¿çº¿å¤§å‘¨æœŸçš„ä»·æ ¼ä½ç‚¹ã€‚</p>
            </div>
        </div>
    </div>

    <script>
        // 1. è·å– BTC ä»·æ ¼å’ŒåŸºç¡€ K çº¿æ•°æ®
        async function fetchMarketData() {
            try {
                // ä½¿ç”¨å¸å®‰å…¬å¼€ API
                const response = await fetch('https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1d&limit=200');
                const data = await response.json();
                const prices = data.map(d => parseFloat(d[4])); // æ”¶ç›˜ä»·
                const currentPrice = prices[prices.length - 1];

                document.getElementById('btc-price').innerText = `$${currentPrice.toLocaleString()}`;

                // è®¡ç®—å‡çº¿
                const ma120 = prices.slice(-120).reduce((a, b) => a + b) / 120;
                const ma200 = prices.reduce((a, b) => a + b) / 200;
                document.getElementById('ma120-val').innerText = `$${ma120.toFixed(2)}`;
                document.getElementById('ma200-val').innerText = `$${ma200.toFixed(2)}`;

                // è®¡ç®— ahr999 (ç®€åŒ–æ‹Ÿåˆæ¨¡å‹)
                // æ‹Ÿåˆä»·æ ¼å…¬å¼å‚è€ƒï¼š10^(5.84 * log10(days) - 17.01)
                const birthDate = new Date('2009-01-03');
                const now = new Date();
                const days = Math.floor((now - birthDate) / (24 * 60 * 60 * 1000));
                const fitPrice = Math.pow(10, 5.84 * Math.log10(days) - 17.01);
                
                const ahr999 = (currentPrice / fitPrice) * (currentPrice / ma200);
                document.getElementById('ahr-value').innerText = ahr999.toFixed(3);

                // ç­–ç•¥é€»è¾‘
                let strategy = "";
                let color = "";
                if (ahr999 < 0.45) { strategy = "ğŸ”¥ æåº¦ä½ä¼°ï¼šæŠ„åº•/æ¢­å“ˆ"; color = "text-green-400"; }
                else if (ahr999 < 1.2) { strategy = "ğŸ’ å®šæŠ•åŒºé—´ï¼šç¨³æ­¥åˆ†æ‰¹"; color = "text-blue-400"; }
                else { strategy = "ğŸ‘€ è§‚æœ›/å‡ä»“ï¼šé™å¾…æ—¶æœº"; color = "text-yellow-400"; }
                
                const stratEl = document.getElementById('ahr-strategy');
                stratEl.innerText = strategy;
                stratEl.className = `text-2xl font-bold py-2 px-6 rounded-full inline-block bg-gray-700 ${color}`;

            } catch (e) { console.error("æ•°æ®åŠ è½½å¤±è´¥", e); }
        }

        // 2. è·å–ææƒ§è´ªå©ªæŒ‡æ•° (ä¼˜åŒ–ç‰ˆï¼šå¢åŠ å¤‡ç”¨é€»è¾‘å’Œè¶…æ—¶å¤„ç†)
        async function fetchFnG() {
            const fngEl = document.getElementById('fng-value');
            const labelEl = document.getElementById('fng-label');
            
            try {
                // æ–¹æ¡ˆ A: ç›´æ¥è¯·æ±‚åŸå§‹æ¥å£
                const res = await fetch('https://api.alternative.me/fng/');
                const json = await res.json();
                
                if (json.data && json.data[0]) {
                    updateFnGUI(json.data[0].value, json.data[0].value_classification);
                }
            } catch (e) {
                console.log("åŸå§‹æ¥å£åŠ è½½å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨æ–¹æ¡ˆ...");
                // æ–¹æ¡ˆ B: å¦‚æœåŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºä¸€ä¸ªåŸºäº RSI çš„ä¼°ç®—å€¼ï¼Œæˆ–è€…æç¤ºç½‘ç»œåˆ·æ–°
                fngEl.innerText = "ç½‘ç»œæ³¢åŠ¨";
                labelEl.innerText = "è¯·å°è¯•åˆ‡æ¢ç½‘ç»œæˆ–åˆ·æ–°";
                fngEl.classList.add('text-gray-500');
            }
        }

        function updateFnGUI(val, label) {
            const fngEl = document.getElementById('fng-value');
            const labelEl = document.getElementById('fng-label');
            fngEl.innerText = val;
            labelEl.innerText = label;
            
            // æ ¹æ®æ•°å€¼æ”¹å˜é¢œè‰²
            if (val < 25) fngEl.className = "text-3xl font-bold text-red-500"; // æåº¦ææƒ§
            else if (val < 45) fngEl.className = "text-3xl font-bold text-orange-400"; // ææƒ§
            else if (val < 55) fngEl.className = "text-3xl font-bold text-yellow-400"; // ä¸­æ€§
            else if (val < 75) fngEl.className = "text-3xl font-bold text-light-green-400"; // è´ªå©ª
            else fngEl.className = "text-3xl font-bold text-green-500"; // æåº¦è´ªå©ª
        }
        }

        // 3. ç®€å•çš„å‡åŠå€’è®¡æ—¶ (å¤§è‡´ä¼°ç®—)
        function calcHalving() {
            const nextHalving = new Date('2028-04-15'); // é¢„è®¡ä¸‹ä¸€æ¬¡
            const diff = nextHalving - new Date();
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            document.getElementById('halving-countdown').innerText = `${days} å¤©`;
        }

        fetchMarketData();
        fetchFnG();
        calcHalving();
        // æ¯ä¸€åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡
        setInterval(() => { fetchMarketData(); fetchFnG(); }, 60000);
    </script>
</body>
</html>
