<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>BTC 交易看板 (直连版)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: sans-serif; }
        .card { background-color: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; text-align: center; }
        .value { font-size: 2rem; font-weight: 700; color: #f8fafc; }
        /* 状态色 */
        .text-buy { color: #4ade80; } /* 绿 */
        .text-wait { color: #f87171; } /* 红 */
        .text-dca { color: #60a5fa; } /* 蓝 */
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-5xl mx-auto">
        <div class="text-center mb-8">
            <h1 class="text-2xl font-bold tracking-wider text-white">BTC MARKET MONITOR</h1>
            <p class="text-xs text-gray-500 mt-2">直连模式 | 请确保梯子已开启全局</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            
            <div class="card flex flex-col justify-center items-center">
                <div class="text-gray-400 text-sm mb-2">市场情绪 (Fear & Greed)</div>
                <img src="https://alternative.me/crypto/fear-and-greed-index.png" alt="Fear & Greed" class="w-full max-w-[200px] rounded-lg">
            </div>

            <div class="card ring-1 ring-blue-500/20">
                <div class="text-gray-400 text-sm mb-2">ahr999 囤币指标</div>
                <div id="ahr-val" class="value">--</div>
                <div id="ahr-action" class="mt-2 px-3 py-1 text-sm font-bold bg-gray-700 rounded-full inline-block">正在计算...</div>
                <div class="text-xs text-gray-500 mt-2">数据源: 币安 API 直连</div>
            </div>

            <div class="card">
                <div class="text-gray-400 text-sm mb-2">BTC 实时价格</div>
                <div id="btc-price" class="value text-yellow-400">Loading...</div>
                <div id="price-change" class="text-sm font-mono mt-1">--</div>
            </div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="card py-4">
                <div class="text-xs text-gray-500">MA 120 (牛熊线)</div>
                <div id="ma120" class="text-lg font-bold">--</div>
            </div>
            <div class="card py-4">
                <div class="text-xs text-gray-500">MA 200 (长期成本)</div>
                <div id="ma200" class="text-lg font-bold">--</div>
            </div>
            <div class="card py-4">
                <div class="text-xs text-gray-500">RSI (14)</div>
                <div id="rsi" class="text-lg font-bold">--</div>
            </div>
            <div class="card py-4">
                <div class="text-xs text-gray-500">减半倒计时</div>
                <div id="halving" class="text-lg font-bold text-blue-400">--</div>
            </div>
        </div>
    </div>

    <script>
        // 核心逻辑：直连币安，不经过任何代理
        async function fetchData() {
            try {
                // 直接请求币安接口
                const res = await fetch("https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1d&limit=200");
                const data = await res.json();
                
                // 数据处理
                const prices = data.map(k => parseFloat(k[4]));
                const currentPrice = prices[prices.length - 1];
                const prevPrice = prices[prices.length - 2];

                // 1. 更新价格
                document.getElementById('btc-price').innerText = `$${Math.floor(currentPrice).toLocaleString()}`;
                
                // 2. 计算均线
                const ma120 = prices.slice(-120).reduce((a,b)=>a+b)/120;
                const ma200 = prices.reduce((a,b)=>a+b)/200;
                document.getElementById('ma120').innerText = `$${Math.floor(ma120)}`;
                document.getElementById('ma200').innerText = `$${Math.floor(ma200)}`;

                // 3. 计算 RSI
                let gains = 0, losses = 0;
                for(let i=prices.length-14; i<prices.length; i++) {
                    let diff = prices[i] - prices[i-1];
                    if(diff > 0) gains += diff; else losses += Math.abs(diff);
                }
                let rsi = 100 - (100 / (1 + (gains/losses)));
                let rsiEl = document.getElementById('rsi');
                rsiEl.innerText = rsi.toFixed(1);
                rsiEl.className = rsi < 30 ? "text-lg font-bold text-buy" : (rsi > 70 ? "text-lg font-bold text-wait" : "text-lg font-bold");

                // 4. 计算 ahr999
                // 拟合价格公式 (固定常数)
                const birth = new Date("2009-01-03").getTime();
                const now = new Date().getTime();
                const days = (now - birth) / 86400000;
                const fitPrice = Math.pow(10, 5.84 * Math.log10(days) - 17.01);
                
                const ahr999 = (currentPrice / fitPrice) * (currentPrice / ma200);
                const ahrEl = document.getElementById('ahr-val');
                const actEl = document.getElementById('ahr-action');
                
                ahrEl.innerText = ahr999.toFixed(3);
                
                if (ahr999 < 0.45) {
                    ahrEl.className = "value text-buy";
                    actEl.innerText = "抄底区间 (Buy)";
                    actEl.className = "mt-2 px-3 py-1 text-sm font-bold bg-green-900 text-green-200 rounded-full inline-block";
                } else if (ahr999 < 1.2) {
                    ahrEl.className = "value text-dca";
                    actEl.innerText = "定投区间 (DCA)";
                    actEl.className = "mt-2 px-3 py-1 text-sm font-bold bg-blue-900 text-blue-200 rounded-full inline-block";
                } else {
                    ahrEl.className = "value text-wait";
                    actEl.innerText = "等待观望 (Wait)";
                    actEl.className = "mt-2 px-3 py-1 text-sm font-bold bg-red-900 text-red-200 rounded-full inline-block";
                }

                // 5. 减半倒计时
                const nextHalving = new Date("2028-04-15").getTime();
                document.getElementById('halving').innerText = Math.floor((nextHalving - now)/86400000) + " 天";

            } catch (e) {
                console.error(e);
                document.getElementById('btc-price').innerText = "连接失败";
                document.getElementById('btc-price').className = "value text-sm text-red-500";
            }
        }

        fetchData();
    </script>
</body>
</html>
